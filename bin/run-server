#!/bin/bash
if [ ! -d keys ]; then
	echo "Keys do not exist"
	if [ -d PKI ]; then
		echo "Genertating Server Keys"
		cd easy-rsa
		export KEY_DIR=$PWD/../PKI
		source ./vars > /dev/null
		./build-dh
		./pkitool --server server 2> /dev/null
		cd ..
		mkdir -p keys
		mv PKI/dh1024.pem keys/
		mv PKI/server.crt keys/
		mv PKI/server.key keys/
		mv PKI/ca.crt keys/
		rm -rf easy-rsa
		rm -rf PKI
		echo "Server Keys gernerated in keys/"
	else
		echo "Please Provide PKI/"
	fi
else
	if [ -d PKI ]; then
		echo "Cleaning PKI for Security"
		rm -rf PKI
	fi
	echo "~~~~~Starting VPN Server~~~~"
	echo "Detach Container with CTRL-C"
	echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
	exec openvpn server.conf
fi
